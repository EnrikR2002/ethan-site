---
import "../styles/global.css";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>Astro Basics</title>
  </head>
  <body>
    <slot />

    <script>
      /* @ts-nocheck */
      // Keep scroll restoration manual so reloads don't preserve previous scroll
      if ("scrollRestoration" in history) history.scrollRestoration = "manual";

      // Ensure we start at the top on load and when navigating back/forward
      function resetScrollToTop() {
        // run after restoration to be safe
        setTimeout(function () {
          window.scrollTo(0, 0);
        }, 0);
      }
      window.addEventListener("load", resetScrollToTop);
      window.addEventListener("pageshow", function (e) {
        if (e.persisted) resetScrollToTop();
      });

      // Smooth scroll duration: native smooth used (browser controls timing)
      document.addEventListener(
        "click",
        function (e) {
          var a = e.target instanceof Element ? e.target.closest("a") : null;
          if (!a) return;
          var href = a.getAttribute("href");
          if (!href) return;

          // Determine if this is a same-page hash (e.g. #taste or /#taste)
          var samePageHash = false;
          if (href.charAt(0) === "#") samePageHash = true;
          else {
            try {
              var tmp = new URL(href, location.href);
              samePageHash =
                tmp.origin === location.origin &&
                tmp.pathname === location.pathname &&
                !!tmp.hash &&
                tmp.hash.length > 1;
            } catch (err) {
              samePageHash = false;
            }
          }

          if (samePageHash) {
            e.preventDefault();
            var hash =
              href.charAt(0) === "#" ? href : new URL(href, location.href).hash;
            try {
              var target = document.querySelector(hash);
              if (target) {
                // custom smooth scroll using rAF for consistency across browsers
                var targetY =
                  target.getBoundingClientRect().top + window.scrollY;
                var startY = window.scrollY;
                var duration = 300; // ms
                var startT = performance.now();
                /** @type {(t: number) => number} */
                var easeOut = function (t) {
                  return 1 - Math.pow(1 - t, 3);
                };
                /** @type {(currentTime: number) => void} */
                var step = function (currentTime) {
                  var p = Math.min(1, (currentTime - startT) / duration);
                  window.scrollTo(0, startY + (targetY - startY) * easeOut(p));
                  if (p < 1) requestAnimationFrame(step);
                  else {
                    try {
                      history.pushState(null, "", hash);
                    } catch (e) {}
                  }
                };
                requestAnimationFrame(step);
              }
            } catch (err) {
              // fallback: jump
              location.hash = hash;
            }
            return;
          }

          // keep mailto and tel as-is
          if (href.startsWith("mailto:") || href.startsWith("tel:")) return;

          // For all other links, ensure they open in a new tab per request
          try {
            var url = new URL(href, location.href);
            // set attributes for internal and external links
            a.setAttribute("target", "_blank");
            a.setAttribute("rel", "noopener noreferrer");
          } catch (err) {
            // malformed URL, leave it
          }
        },
        true
      );
    </script>
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
</style>
